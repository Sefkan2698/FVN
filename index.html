<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FVN Schiedsrichter-Beobachtungsbogen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 10px;
            font-size: 14px;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 16px;
            }
        }
        
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .login-form h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .login-form input {
            width: 100%;
            padding: 15px 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            min-height: 48px;
        }
        
        .login-form button {
            width: 100%;
            padding: 15px 12px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            min-height: 48px;
        }
        
        .login-form button:hover {
            background: #0052a3;
        }
        
        .error-message {
            color: red;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                padding: 20px;
            }
        }
        
        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .header {
                flex-direction: row;
                justify-content: center;
                gap: 20px;
                margin-bottom: 30px;
            }
        }
        
        .logo {
            height: 50px;
            width: auto;
        }
        
        @media (min-width: 768px) {
            .logo {
                height: 60px;
            }
        }
        
        .header-text {
            color: #0066cc;
            font-size: 16px;
            font-weight: bold;
            line-height: 1.3;
        }
        
        @media (min-width: 768px) {
            .header-text {
                font-size: 18px;
                text-align: left;
            }
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            background: #0066cc;
            color: white;
            padding: 12px 10px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        @media (min-width: 768px) {
            .section-title {
                padding: 10px;
                font-size: 14px;
            }
        }
        
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        @media (min-width: 768px) {
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        @media (min-width: 768px) {
            .form-group {
                flex-direction: row;
                align-items: center;
                gap: 10px;
            }
        }
        
        .form-group label {
            font-weight: bold;
            min-width: auto;
            margin-right: 0;
        }
        
        @media (min-width: 768px) {
            .form-group label {
                min-width: 150px;
                margin-right: 10px;
            }
        }
        
        .form-group input, .form-group select, .form-group textarea {
            flex: 1;
            padding: 12px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            min-height: 48px;
        }
        
        @media (min-width: 768px) {
            .form-group input, .form-group select, .form-group textarea {
                padding: 8px;
                font-size: 14px;
                min-height: auto;
            }
        }
        
        .criteria-section {
            margin-bottom: 20px;
        }
        
        .criteria-header {
            background: #e6f2ff;
            padding: 10px;
            font-weight: bold;
            border-left: 4px solid #0066cc;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        @media (min-width: 768px) {
            .criteria-header {
                padding: 8px;
                font-size: 14px;
            }
        }
        
        .criteria-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 12px 8px;
            border-bottom: 1px solid #eee;
        }
        
        @media (min-width: 768px) {
            .criteria-item {
                display: grid;
                grid-template-columns: 3fr 1fr 1fr 1fr;
                flex-direction: row;
                align-items: center;
                padding: 8px 0;
            }
        }
        
        .criteria-item:last-child {
            border-bottom: none;
        }
        
        .criteria-label {
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        @media (min-width: 768px) {
            .criteria-label {
                margin-bottom: 0;
            }
        }
        
        .criteria-ratings {
            display: flex;
            gap: 5px;
            justify-content: space-around;
        }
        
        @media (min-width: 768px) {
            .criteria-ratings {
                display: contents;
            }
        }
        
        .radio-group {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px 10px;
            border-radius: 6px;
            transition: all 0.3s ease;
            min-height: 50px;
            flex: 1;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (min-width: 768px) {
            .radio-group {
                padding: 10px;
                min-height: auto;
            }
        }

        .radio-group.rating-1 {
            background-color: #ffebee;
            border: 2px solid #ffcdd2;
        }

        .radio-group.rating-1:hover,
        .radio-group.rating-1:has(input:checked) {
            background-color: #ffcdd2;
            border-color: #ef5350;
            box-shadow: 0 2px 8px rgba(239, 83, 80, 0.3);
        }

        .radio-group.rating-2 {
            background-color: #fff3e0;
            border: 2px solid #ffcc02;
        }

        .radio-group.rating-2:hover,
        .radio-group.rating-2:has(input:checked) {
            background-color: #ffe0b2;
            border-color: #ff9800;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
        }

        .radio-group.rating-3 {
            background-color: #e8f5e8;
            border: 2px solid #c8e6c9;
        }

        .radio-group.rating-3:hover,
        .radio-group.rating-3:has(input:checked) {
            background-color: #c8e6c9;
            border-color: #66bb6a;
            box-shadow: 0 2px 8px rgba(102, 187, 106, 0.3);
        }

        .radio-group input[type="radio"] {
            margin: 0 10px 0 0;
            transform: scale(1.6);
            cursor: pointer;
        }
        
        @media (min-width: 768px) {
            .radio-group input[type="radio"] {
                transform: scale(1.3);
                margin: 0 8px 0 0;
            }
        }
        
        .radio-group label {
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
        }
        
        @media (min-width: 768px) {
            .radio-group label {
                font-size: 16px;
            }
        }
        
        .explanation {
            background: #fff9e6;
            border: 1px solid #ffe066;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .explanation p {
            margin-bottom: 8px;
            color: #666;
        }
        
        .text-areas-section {
            margin-bottom: 20px;
        }
        
        .text-area-group {
            margin-bottom: 20px;
        }
        
        .text-area-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .text-area-group textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
        
        @media (min-width: 768px) {
            .text-area-group textarea {
                min-height: 100px;
                font-size: 14px;
            }
        }
        
        .summary-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .summary-section {
                display: grid;
                grid-template-columns: 2fr 1fr 1fr 1fr;
                flex-direction: row;
                gap: 15px;
                align-items: center;
                padding: 10px;
            }
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .summary-row:last-child {
            border-bottom: none;
            background: #e6f2ff;
            border-radius: 4px;
            padding: 12px 8px;
            margin-top: 10px;
        }
        
        @media (min-width: 768px) {
            .summary-row {
                display: contents;
                margin-bottom: 0;
                padding: 0;
                border-bottom: none;
                background: transparent;
                border-radius: 0;
                margin-top: 0;
            }
        }
        
        .summary-label {
            font-weight: bold;
            flex: 1;
        }
        
        .summary-input {
            text-align: center;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-weight: bold;
            min-width: 80px;
            background: white;
            font-size: 16px;
        }
        
        @media (min-width: 768px) {
            .summary-input {
                min-width: auto;
                font-size: 14px;
            }
        }
        
        .submit-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .submit-button {
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin: 5px;
            min-height: 48px;
            width: 100%;
            max-width: 300px;
        }
        
        @media (min-width: 768px) {
            .submit-button {
                width: auto;
                padding: 12px 30px;
            }
        }
        
        .submit-button:hover {
            background: #218838;
        }
        
        .submit-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .logout-button {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            padding: 10px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 999;
        }
        
        @media (min-width: 768px) {
            .logout-button {
                top: 20px;
                right: 20px;
                padding: 8px 16px;
                font-size: 14px;
            }
        }
        
        .logout-button:hover {
            background: #c82333;
        }
        
        .hidden {
            display: none;
        }
        
        .invalid-input {
            border-color: #dc3545 !important;
            background-color: #f8d7da;
        }
        
        .error-text {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            text-align: center;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginContainer" class="login-container">
        <div class="login-form">
            <h2>FVN Beobachtungsbogen</h2>
            <p>Bitte melden Sie sich an:</p>
            <input type="text" id="username" placeholder="Benutzername">
            <input type="password" id="password" placeholder="Passwort">
            <button onclick="login()">Anmelden</button>
            <div id="loginError" class="error-message" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <button class="logout-button" onclick="logout()">Abmelden</button>
        
        <div class="container">
            <div class="header">
                <img src="assets/fvn-logo.png" alt="FVN Logo" class="logo">
                <div class="header-text">
                    FVN - Schiedsrichter<br>
                    Beobachtungsbogen A- und B-Junioren-Niederrheinliga
                </div>
            </div>
            
            <form id="observationForm" onsubmit="return submitForm(event)">
                <!-- Informationen zur Beobachtung -->
                <div class="section">
                    <div class="section-title">Informationen zur Beobachtung</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Beobachter:</label>
                            <input type="text" name="observer" required>
                        </div>
                        <div class="form-group">
                            <label>Datum:</label>
                            <input type="date" name="date" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Begegnung:</label>
                            <input type="text" name="match" required placeholder="Verein A - Verein B">
                        </div>
                        <div class="form-group">
                            <label>Spielklasse:</label>
                            <select name="league" required>
                                <option value="">Bitte wählen</option>
                                <option value="A-NRL">A-NRL</option>
                                <option value="B-NRL">B-NRL</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Schiedsrichter:</label>
                            <input type="text" name="referee" required>
                        </div>
                        <div class="form-group">
                            <label>Halbzeitstand:</label>
                            <input type="text" name="halftime" required placeholder="x:y" pattern="^\d+:\d+$" title="Format: x:y (z.B. 1:2)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Schiedsrichterassistent 1:</label>
                            <input type="text" name="assistant1" required>
                        </div>
                        <div class="form-group">
                            <label>Endstand:</label>
                            <input type="text" name="fulltime" required placeholder="x:y" pattern="^\d+:\d+$" title="Format: x:y (z.B. 2:4)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Schiedsrichterassistent 2:</label>
                            <input type="text" name="assistant2" required>
                        </div>
                        <div class="form-group">
                            <label>Kader:</label>
                            <select name="squad" required>
                                <option value="">Bitte wählen</option>
                                <option value="U19">U19</option>
                                <option value="U20">U20</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Erläuterung -->
                <div class="section">
                    <div class="section-title">Erläuterung</div>
                    <div class="explanation">
                        <p><strong>1</strong> = Optimierungsbedarf (nicht zufrieden stellend)</p>
                        <p><strong>2</strong> = Entspricht den Anforderungen (keine Relevanz/Neutrale Bewertung)</p>
                        <p><strong>3</strong> = Überdurchschnittliche Anforderung (mehr als zufrieden stellend)</p>
                        <br>
                        <p><strong>In jeder Zeile nur eine der drei Möglichkeiten wählen!</strong></p>
                        <p><strong>Wird die Zahl 1 oder 3 gewählt, ist im Kommentarfeld eine kurze, konkrete Begründung erforderlich.</strong></p>
                    </div>
                </div>
                
                <!-- Beobachtungskriterien -->
                <div class="section">
                    <div class="section-title">Beobachtungskriterien</div>
                    
                    <!-- 1. Spielverständnis -->
                    <div class="criteria-section">
                        <div class="criteria-header">1. Spielverständnis</div>
                        <div class="criteria-item">
                            <div class="criteria-label">1.1 Erkennen des Spielcharakters / von Spielphasen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_1_1" value="1" required id="criteria_1_1_1">
                                    <label for="criteria_1_1_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_1_1" value="2" required id="criteria_1_1_2">
                                    <label for="criteria_1_1_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_1_1" value="3" required id="criteria_1_1_3">
                                    <label for="criteria_1_1_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">1.2 Regelkonformität / Regelverstöße</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_1_2" value="1" required id="criteria_1_2_1">
                                    <label for="criteria_1_2_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_1_2" value="2" required id="criteria_1_2_2">
                                    <label for="criteria_1_2_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_1_2" value="3" required id="criteria_1_2_3">
                                    <label for="criteria_1_2_3">3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. Zweikampfbeurteilung -->
                    <div class="criteria-section">
                        <div class="criteria-header">2. Zweikampfbeurteilung</div>
                        <div class="criteria-item">
                            <div class="criteria-label">2.1 Fußvergehen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_2_1" value="1" required id="criteria_2_1_1">
                                    <label for="criteria_2_1_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_2_1" value="2" required id="criteria_2_1_2">
                                    <label for="criteria_2_1_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_2_1" value="3" required id="criteria_2_1_3">
                                    <label for="criteria_2_1_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">2.2 Oberkörpervergehen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_2_2" value="1" required id="criteria_2_2_1">
                                    <label for="criteria_2_2_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_2_2" value="2" required id="criteria_2_2_2">
                                    <label for="criteria_2_2_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_2_2" value="3" required id="criteria_2_2_3">
                                    <label for="criteria_2_2_3">3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3. Disziplinarkontrolle -->
                    <div class="criteria-section">
                        <div class="criteria-header">3. Disziplinarkontrolle</div>
                        <div class="criteria-item">
                            <div class="criteria-label">3.1 Ansprachen / Ermahnungen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_3_1" value="1" required id="criteria_3_1_1">
                                    <label for="criteria_3_1_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_3_1" value="2" required id="criteria_3_1_2">
                                    <label for="criteria_3_1_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_3_1" value="3" required id="criteria_3_1_3">
                                    <label for="criteria_3_1_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">3.2 Verwarnungen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_3_2" value="1" required id="criteria_3_2_1">
                                    <label for="criteria_3_2_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_3_2" value="2" required id="criteria_3_2_2">
                                    <label for="criteria_3_2_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_3_2" value="3" required id="criteria_3_2_3">
                                    <label for="criteria_3_2_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">3.3 Feldverweise</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_3_3" value="1" required id="criteria_3_3_1">
                                    <label for="criteria_3_3_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_3_3" value="2" required id="criteria_3_3_2">
                                    <label for="criteria_3_3_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_3_3" value="3" required id="criteria_3_3_3">
                                    <label for="criteria_3_3_3">3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 4. Persönliches Auftreten -->
                    <div class="criteria-section">
                        <div class="criteria-header">4. Persönliches Auftreten</div>
                        <div class="criteria-item">
                            <div class="criteria-label">4.1 Akzeptanz / Persönlichkeit</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_4_1" value="1" required id="criteria_4_1_1">
                                    <label for="criteria_4_1_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_4_1" value="2" required id="criteria_4_1_2">
                                    <label for="criteria_4_1_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_4_1" value="3" required id="criteria_4_1_3">
                                    <label for="criteria_4_1_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">4.2 Durchsetzungsvermögen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_4_2" value="1" required id="criteria_4_2_1">
                                    <label for="criteria_4_2_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_4_2" value="2" required id="criteria_4_2_2">
                                    <label for="criteria_4_2_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_4_2" value="3" required id="criteria_4_2_3">
                                    <label for="criteria_4_2_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">4.3 Kommunikation (Ansprache, Dialog)</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_4_3" value="1" required id="criteria_4_3_1">
                                    <label for="criteria_4_3_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_4_3" value="2" required id="criteria_4_3_2">
                                    <label for="criteria_4_3_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_4_3" value="3" required id="criteria_4_3_3">
                                    <label for="criteria_4_3_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">4.4 Präsentation (Gestik, Mimik, Pfiffe)</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_4_4" value="1" required id="criteria_4_4_1">
                                    <label for="criteria_4_4_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_4_4" value="2" required id="criteria_4_4_2">
                                    <label for="criteria_4_4_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_4_4" value="3" required id="criteria_4_4_3">
                                    <label for="criteria_4_4_3">3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 5. Fitness und Stellungsspiel -->
                    <div class="criteria-section">
                        <div class="criteria-header">5. Fitness und Stellungsspiel</div>
                        <div class="criteria-item">
                            <div class="criteria-label">5.1 Laufvermögen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_5_1" value="1" required id="criteria_5_1_1">
                                    <label for="criteria_5_1_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_5_1" value="2" required id="criteria_5_1_2">
                                    <label for="criteria_5_1_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_5_1" value="3" required id="criteria_5_1_3">
                                    <label for="criteria_5_1_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">5.2 Einblick und Positionierung laufendes Spiel</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_5_2" value="1" required id="criteria_5_2_1">
                                    <label for="criteria_5_2_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_5_2" value="2" required id="criteria_5_2_2">
                                    <label for="criteria_5_2_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_5_2" value="3" required id="criteria_5_2_3">
                                    <label for="criteria_5_2_3">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-label">5.3 Einblick und Positionierung Spielfortsetzungen</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_5_3" value="1" required id="criteria_5_3_1">
                                    <label for="criteria_5_3_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_5_3" value="2" required id="criteria_5_3_2">
                                    <label for="criteria_5_3_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_5_3" value="3" required id="criteria_5_3_3">
                                    <label for="criteria_5_3_3">3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 6. Teamarbeit -->
                    <div class="criteria-section">
                        <div class="criteria-header">6. Teamarbeit</div>
                        <div class="criteria-item">
                            <div class="criteria-label">6.1 Zusammenarbeit</div>
                            <div class="criteria-ratings">
                                <div class="radio-group rating-1">
                                    <input type="radio" name="criteria_6_1" value="1" required id="criteria_6_1_1">
                                    <label for="criteria_6_1_1">1</label>
                                </div>
                                <div class="radio-group rating-2">
                                    <input type="radio" name="criteria_6_1" value="2" required id="criteria_6_1_2">
                                    <label for="criteria_6_1_2">2</label>
                                </div>
                                <div class="radio-group rating-3">
                                    <input type="radio" name="criteria_6_1" value="3" required id="criteria_6_1_3">
                                    <label for="criteria_6_1_3">3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Erläuterung der Schiedsrichterleistung -->
                <div class="section">
                    <div class="section-title">Erläuterung der Schiedsrichterleistung</div>
                    
                    <div class="text-areas-section">
                        <div class="text-area-group">
                            <label>Positive Erkenntnisse:</label>
                            <textarea name="positive_notes" placeholder="Beschreiben Sie positive Aspekte der Schiedsrichterleistung..."></textarea>
                        </div>
                        
                        <div class="text-area-group">
                            <label>Zu optimierende Bereiche:</label>
                            <textarea name="improvement_notes" placeholder="Beschreiben Sie Bereiche, die optimiert werden können..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Beurteilung der Gesamtleistung -->
                <div class="section">
                    <div class="section-title">Beurteilung der Gesamtleistung</div>
                    
                    <div class="summary-section">
                        <div class="summary-row">
                            <div class="summary-label">Anzahl Bewertungen "1" (Optimierungsbedarf):</div>
                            <div class="summary-input" id="count1">0</div>
                        </div>
                        <div class="summary-row">
                            <div class="summary-label">Punkte (x1):</div>
                            <div class="summary-input" id="points1">0</div>
                        </div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-row">
                            <div class="summary-label">Anzahl Bewertungen "2" (Entspricht Anforderungen):</div>
                            <div class="summary-input" id="count2">0</div>
                        </div>
                        <div class="summary-row">
                            <div class="summary-label">Punkte (x2):</div>
                            <div class="summary-input" id="points2">0</div>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-row">
                            <div class="summary-label">Anzahl Bewertungen "3" (Überdurchschnittlich):</div>
                            <div class="summary-input" id="count3">0</div>
                        </div>
                        <div class="summary-row">
                            <div class="summary-label">Punkte (x3):</div>
                            <div class="summary-input" id="points3">0</div>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-row">
                            <div class="summary-label"><strong>Gesamtpunktzahl:</strong></div>
                            <div class="summary-input" id="totalPoints" style="background: #e6f2ff; font-size: 18px;"><strong>0</strong></div>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Section -->
                <div class="submit-section">
                    <p><strong>PDF-Download</strong></p>
                    <button type="submit" class="submit-button" id="downloadBtn">
                        <span id="btnText">PDF herunterladen</span>
                        <span id="loadingSpinner" class="loading hidden"></span>
                    </button>
                    <div id="successMessage" class="success-message" style="display: none;">
                        Das PDF wurde erfolgreich erstellt und heruntergeladen!
                    </div>
                    <div id="errorMessage" class="error-message" style="display: none;"></div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Authentication credentials
        let isLoggedIn = false;

        // Simple authentication check
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            // Simple credential check
            if (username === 'fvn_beobachter' && password === 'beobachtung2024') {
                isLoggedIn = true;
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                errorDiv.style.display = 'none';
                
                // Initialize form
                initializeForm();
            } else {
                errorDiv.textContent = 'Ungültige Anmeldedaten. Bitte versuchen Sie es erneut.';
                errorDiv.style.display = 'block';
                document.getElementById('password').value = '';
            }
        }

        function logout() {
            isLoggedIn = false;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('observationForm').reset();
        }

        function initializeForm() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="date"]').value = today;
            
            // Add event listeners for score calculation
            const criteriaRadios = document.querySelectorAll('input[type="radio"][name^="criteria_"]');
            criteriaRadios.forEach(radio => {
                radio.addEventListener('change', calculateScores);
            });
            
            // Add validation for score format
            const scoreInputs = document.querySelectorAll('input[name="halftime"], input[name="fulltime"]');
            scoreInputs.forEach(input => {
                input.addEventListener('input', validateScoreFormat);
            });
            
            // Mobile optimization: Make radio group containers clickable
            const radioGroups = document.querySelectorAll('.radio-group');
            radioGroups.forEach(group => {
                group.addEventListener('click', function(e) {
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio && e.target !== radio && e.target.tagName !== 'LABEL') {
                        radio.checked = true;
                        radio.dispatchEvent(new Event('change'));
                    }
                });
            });
        }

        function validateScoreFormat(event) {
            const input = event.target;
            const value = input.value;
            const pattern = /^\d+:\d+$/;
            
            if (value && !pattern.test(value)) {
                input.classList.add('invalid-input');
                if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('error-text')) {
                    const errorSpan = document.createElement('span');
                    errorSpan.className = 'error-text';
                    errorSpan.textContent = 'Format: x:y (z.B. 1:2)';
                    input.parentNode.appendChild(errorSpan);
                }
            } else {
                input.classList.remove('invalid-input');
                const errorSpan = input.parentNode.querySelector('.error-text');
                if (errorSpan) {
                    errorSpan.remove();
                }
            }
        }

        function calculateScores() {
            const criteriaRadios = document.querySelectorAll('input[type="radio"][name^="criteria_"]:checked');
            let counts = { '1': 0, '2': 0, '3': 0 };
            
            criteriaRadios.forEach(radio => {
                counts[radio.value]++;
            });
            
            // Update counts
            document.getElementById('count1').textContent = counts['1'];
            document.getElementById('count2').textContent = counts['2'];  
            document.getElementById('count3').textContent = counts['3'];
            
            // Calculate weighted scores
            const points1 = counts['1'] * 1;
            const points2 = counts['2'] * 2;
            const points3 = counts['3'] * 3;
            
            document.getElementById('points1').textContent = points1;
            document.getElementById('points2').textContent = points2;
            document.getElementById('points3').textContent = points3;
            
            const totalPoints = points1 + points2 + points3;
            document.getElementById('totalPoints').innerHTML = `<strong>${totalPoints}</strong>`;
        }

        async function submitForm(event) {
            event.preventDefault();
            
            if (!isLoggedIn) {
                alert('Sie müssen sich anmelden, um das Formular zu senden.');
                return false;
            }
            
            const form = document.getElementById('observationForm');
            const downloadBtn = document.getElementById('downloadBtn');
            const btnText = document.getElementById('btnText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            // Validate form
            if (!validateForm(form)) {
                return false;
            }
            
            // Show loading state
            downloadBtn.disabled = true;
            btnText.textContent = 'PDF wird erstellt...';
            loadingSpinner.classList.remove('hidden');
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            try {
                // Collect form data
                const formData = collectFormData(form);
                
                // Try to call the Netlify function
                const response = await fetch('/.netlify/functions/generate-pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        // Download PDF
                        const pdfBlob = new Blob([atob(result.pdf)], { type: 'application/pdf' });
                        const url = window.URL.createObjectURL(pdfBlob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = result.filename;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        successMessage.textContent = 'PDF wurde erfolgreich heruntergeladen!';
                        successMessage.style.display = 'block';
                    } else {
                        throw new Error(result.error);
                    }
                } else {
                    throw new Error(`Function returned: ${response.status}`);
                }
                
            } catch (error) {
                console.error('PDF generation failed, using fallback:', error);
                
                // Fallback to simple text file
                const fallbackData = collectFormData(form);
                const pdfContent = generateSimplePDF(fallbackData);
                downloadPDFContent(pdfContent, fallbackData);
                
                errorMessage.textContent = 'PDF-Generierung fehlgeschlagen, Text-Version wird heruntergeladen.';
                errorMessage.style.display = 'block';
            } finally {
                // Reset button state
                downloadBtn.disabled = false;
                btnText.textContent = 'PDF herunterladen';
                loadingSpinner.classList.add('hidden');
            }
            
            return false;
        }

        function generateSimplePDF(data) {
            const criteriaLabels = {
                'criteria_1_1': '1.1 Erkennen des Spielcharakters / von Spielphasen',
                'criteria_1_2': '1.2 Regelkonformität / Regelverstöße',
                'criteria_2_1': '2.1 Fußvergehen',
                'criteria_2_2': '2.2 Oberkörpervergehen',
                'criteria_3_1': '3.1 Ansprachen / Ermahnungen',
                'criteria_3_2': '3.2 Verwarnungen',
                'criteria_3_3': '3.3 Feldverweise',
                'criteria_4_1': '4.1 Akzeptanz / Persönlichkeit',
                'criteria_4_2': '4.2 Durchsetzungsvermögen',
                'criteria_4_3': '4.3 Kommunikation (Ansprache, Dialog)',
                'criteria_4_4': '4.4 Präsentation (Gestik, Mimik, Pfiffe)',
                'criteria_5_1': '5.1 Laufvermögen',
                'criteria_5_2': '5.2 Einblick und Positionierung laufendes Spiel',
                'criteria_5_3': '5.3 Einblick und Positionierung Spielfortsetzungen',
                'criteria_6_1': '6.1 Zusammenarbeit'
            };

            let content = `FVN - Schiedsrichter Beobachtungsbogen
A- und B-Junioren-Niederrheinliga

=== INFORMATIONEN ZUR BEOBACHTUNG ===
Beobachter: ${data.observer || ''}
Datum: ${data.date || ''}
Begegnung: ${data.match || ''}
Spielklasse: ${data.league || ''}
Schiedsrichter: ${data.referee || ''}
Halbzeitstand: ${data.halftime || ''}
Schiedsrichterassistent 1: ${data.assistant1 || ''}
Endstand: ${data.fulltime || ''}
Schiedsrichterassistent 2: ${data.assistant2 || ''}
Kader: ${data.squad || ''}

=== BEWERTUNGSKRITERIEN ===
`;

            Object.keys(criteriaLabels).forEach(key => {
                if (data[key]) {
                    content += `${criteriaLabels[key]}: ${data[key]}\n`;
                }
            });

            content += `
=== ERLÄUTERUNG DER SCHIEDSRICHTERLEISTUNG ===
Positive Erkenntnisse:
${data.positive_notes || 'Keine Angaben'}

Zu optimierende Bereiche:
${data.improvement_notes || 'Keine Angaben'}

=== BEURTEILUNG DER GESAMTLEISTUNG ===
Anzahl Bewertungen "1": ${data.summary?.count1 || '0'} (Punkte: ${data.summary?.points1 || '0'})
Anzahl Bewertungen "2": ${data.summary?.count2 || '0'} (Punkte: ${data.summary?.points2 || '0'})
Anzahl Bewertungen "3": ${data.summary?.count3 || '0'} (Punkte: ${data.summary?.points3 || '0'})
GESAMTPUNKTZAHL: ${data.summary?.totalPoints || '0'}

Erstellt am: ${new Date().toLocaleDateString('de-DE')} um ${new Date().toLocaleTimeString('de-DE')}
`;

            return content;
        }

        function downloadPDFContent(content, formData) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Beobachtungsbogen_${formData.date || 'unbekannt'}_${formData.referee?.replace(/\s+/g, '_') || 'unbekannt'}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function validateForm(form) {
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value || (field.type === 'radio' && !form.querySelector(`input[name="${field.name}"]:checked`))) {
                    field.classList.add('invalid-input');
                    isValid = false;
                } else {
                    field.classList.remove('invalid-input');
                }
            });
            
            // Validate score format
            const scoreFields = ['halftime', 'fulltime'];
            scoreFields.forEach(fieldName => {
                const field = form.querySelector(`input[name="${fieldName}"]`);
                if (field.value && !/^\d+:\d+$/.test(field.value)) {
                    field.classList.add('invalid-input');
                    isValid = false;
                }
            });
            
            if (!isValid) {
                alert('Bitte füllen Sie alle Pflichtfelder korrekt aus.');
                return false;
            }
            
            // Check if 1 or 3 ratings require comments
            const needsComment = checkCommentsRequired();
            if (needsComment.length > 0) {
                const positiveNotes = form.querySelector('textarea[name="positive_notes"]').value;
                const improvementNotes = form.querySelector('textarea[name="improvement_notes"]').value;
                
                if (!positiveNotes && !improvementNotes) {
                    alert('Bei Bewertungen mit 1 oder 3 Punkten ist eine Begründung in den Kommentarfeldern erforderlich.');
                    return false;
                }
            }
            
            return true;
        }

        function checkCommentsRequired() {
            const extremeRatings = [];
            const criteriaRadios = document.querySelectorAll('input[type="radio"][name^="criteria_"]:checked');
            
            criteriaRadios.forEach(radio => {
                if (radio.value === '1' || radio.value === '3') {
                    extremeRatings.push(radio.name);
                }
            });
            
            return extremeRatings;
        }

        function collectFormData(form) {
            const formData = new FormData(form);
            const data = {};
            
            // Add basic information
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Add criteria scores
            const criteriaRadios = document.querySelectorAll('input[type="radio"][name^="criteria_"]:checked');
            criteriaRadios.forEach(radio => {
                data[radio.name] = radio.value;
            });
            
            // Add calculated scores
            data.summary = {
                count1: document.getElementById('count1').textContent,
                count2: document.getElementById('count2').textContent,
                count3: document.getElementById('count3').textContent,
                points1: document.getElementById('points1').textContent,
                points2: document.getElementById('points2').textContent,
                points3: document.getElementById('points3').textContent,
                totalPoints: document.getElementById('totalPoints').textContent.replace(/[<>/strong]/g, '')
            };
            
            return data;
        }

        // Initialize login on Enter key press
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('password').focus();
                }
            });
            
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    login();
                }
            });
        });
    </script>
</body>
</html>